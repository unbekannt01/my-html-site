<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ToolMart - Professional Tools Store</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        color: #333;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      /* Header Styles */
      .header {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        padding: 1rem 0;
        box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 0;
        z-index: 1000;
      }

      .nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
      }

      .logo {
        font-size: 2rem;
        font-weight: bold;
        color: #667eea;
        text-decoration: none;
      }

      .nav-links {
        display: flex;
        gap: 2rem;
        align-items: center;
      }

      .nav-link {
        color: #333;
        text-decoration: none;
        font-weight: 500;
        transition: color 0.3s;
      }

      .nav-link:hover {
        color: #667eea;
      }

      .nav-icon {
        position: relative;
        cursor: pointer;
        font-size: 1.5rem;
        color: #667eea;
        padding: 0.5rem;
        border-radius: 8px;
        transition: background-color 0.3s;
      }

      .nav-icon:hover {
        background-color: rgba(102, 126, 234, 0.1);
      }

      .cart-icon {
        position: relative;
        cursor: pointer;
        font-size: 1.5rem;
        color: #667eea;
        padding: 0.5rem;
        border-radius: 8px;
        transition: background-color 0.3s;
      }

      .cart-icon:hover {
        background-color: rgba(102, 126, 234, 0.1);
      }

      .cart-count {
        position: absolute;
        top: -2px;
        right: -2px;
        background: #ff4757;
        color: white;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.8rem;
        font-weight: bold;
      }

      /* Page Sections */
      .page-section {
        display: none;
        min-height: calc(100vh - 80px);
        padding: 2rem 0;
      }

      .page-section.active {
        display: block;
      }

      /* Auth Forms */
      .auth-container {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 80vh;
      }

      .auth-form {
        background: rgba(255, 255, 255, 0.95);
        padding: 3rem;
        border-radius: 20px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(10px);
        width: 100%;
        max-width: 400px;
      }

      .auth-form h2 {
        text-align: center;
        margin-bottom: 2rem;
        color: #333;
        font-size: 2rem;
      }

      .form-group {
        margin-bottom: 1.5rem;
      }

      .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
        color: #555;
      }

      .form-group input,
      .form-group textarea {
        width: 100%;
        padding: 1rem;
        border: 2px solid #e1e8ed;
        border-radius: 10px;
        font-size: 1rem;
        transition: border-color 0.3s;
      }

      .form-group input:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: #667eea;
      }

      .btn {
        width: 100%;
        padding: 1rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.3s, box-shadow 0.3s;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
      }

      .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .auth-switch {
        text-align: center;
        margin-top: 1.5rem;
      }

      .auth-switch a {
        color: #667eea;
        text-decoration: none;
        font-weight: 500;
      }

      /* Products Grid */
      .products-header {
        text-align: center;
        margin-bottom: 3rem;
      }

      .products-header h1 {
        color: white;
        font-size: 3rem;
        margin-bottom: 1rem;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .search-bar {
        max-width: 500px;
        margin: 0 auto 2rem;
        position: relative;
      }

      .search-bar input {
        width: 100%;
        padding: 1rem 1rem 1rem 3rem;
        border: none;
        border-radius: 50px;
        font-size: 1rem;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .search-bar i {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: #999;
      }

      .products-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 2rem;
        margin-top: 2rem;
      }

      .product-card {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s, box-shadow 0.3s;
        backdrop-filter: blur(10px);
      }

      .product-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
      }

      .product-image {
        height: 200px;
        background: linear-gradient(45deg, #f0f2f5, #e1e8ed);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 3rem;
        color: #999;
      }

      .product-info {
        padding: 1.5rem;
      }

      .product-name {
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: #333;
      }

      .product-brand {
        color: #667eea;
        font-weight: 500;
        margin-bottom: 0.5rem;
      }

      .product-price {
        font-size: 1.5rem;
        font-weight: bold;
        color: #2ed573;
        margin-bottom: 1rem;
      }

      .product-description {
        color: #666;
        margin-bottom: 1rem;
        display: -webkit-box;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      .add-to-cart-btn,
      .view-reviews-btn {
        width: 100%;
        padding: 0.8rem;
        background: linear-gradient(135deg, #2ed573 0%, #17a2b8 100%);
        color: white;
        border: none;
        border-radius: 10px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        margin-top: 0.5rem;
      }

      .add-to-cart-btn:hover,
      .view-reviews-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(46, 213, 115, 0.3);
      }

      /* Cart Styles */
      .cart-container {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        padding: 2rem;
        backdrop-filter: blur(10px);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      }

      .cart-item {
        display: flex;
        align-items: center;
        padding: 1rem;
        border-bottom: 1px solid #e1e8ed;
        gap: 1rem;
      }

      .cart-item:last-child {
        border-bottom: none;
      }

      .cart-item-image {
        width: 80px;
        height: 80px;
        background: linear-gradient(45deg, #f0f2f5, #e1e8ed);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: #999;
      }

      .cart-item-info {
        flex: 1;
      }

      .cart-item-name {
        font-weight: 600;
        margin-bottom: 0.5rem;
      }

      .cart-item-price {
        color: #2ed573;
        font-weight: bold;
      }

      .quantity-controls {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin: 0.5rem 0;
      }

      .quantity-btn {
        width: 30px;
        height: 30px;
        border: none;
        background: #667eea;
        color: white;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .quantity {
        padding: 0.5rem 1rem;
        border: 1px solid #e1e8ed;
        border-radius: 5px;
        text-align: center;
        min-width: 60px;
      }

      .remove-btn {
        background: #ff4757;
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 5px;
        cursor: pointer;
      }

      .cart-total {
        text-align: right;
        margin-top: 2rem;
        padding-top: 2rem;
        border-top: 2px solid #e1e8ed;
      }

      .total-amount {
        font-size: 2rem;
        font-weight: bold;
        color: #333;
        margin-bottom: 1rem;
      }

      .checkout-btn {
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        color: white;
        border: none;
        padding: 1rem 2rem;
        border-radius: 10px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
      }

      .checkout-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(255, 107, 107, 0.3);
      }

      /* Checkout Styles */
      .checkout-container {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        padding: 2rem;
        backdrop-filter: blur(10px);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      }

      .checkout-header {
        text-align: center;
        margin-bottom: 2rem;
      }

      .checkout-header h2 {
        color: #333;
        font-size: 2rem;
        margin-bottom: 1rem;
      }

      .order-summary {
        background: #f8f9fa;
        padding: 1.5rem;
        border-radius: 10px;
        margin-bottom: 2rem;
      }

      .summary-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 0.5rem;
      }

      .summary-total {
        display: flex;
        justify-content: space-between;
        font-weight: bold;
        font-size: 1.2rem;
        padding-top: 1rem;
        border-top: 2px solid #e1e8ed;
      }

      .checkout-form {
        margin-top: 2rem;
      }

      .form-row {
        display: flex;
        gap: 1rem;
      }

      .form-row .form-group {
        flex: 1;
      }

      .save-btn {
        background: linear-gradient(135deg, #2ed573 0%, #17a2b8 100%);
        color: white;
        border: none;
        padding: 1rem 2rem;
        border-radius: 10px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        width: 100%;
        margin-top: 1rem;
        transition: all 0.3s;
      }

      .save-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(46, 213, 115, 0.3);
      }

      /* My Order Page Styles */
      .order-page-container {
        max-width: 600px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        padding: 2rem;
        backdrop-filter: blur(10px);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      }

      .order-actions {
        display: flex;
        gap: 1rem;
        margin-top: 2rem;
      }

      .confirm-btn {
        background: linear-gradient(135deg, #2ed573 0%, #17a2b8 100%);
        color: white;
        border: none;
        padding: 1rem 2rem;
        border-radius: 10px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        flex: 1;
        transition: all 0.3s;
      }

      .confirm-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(46, 213, 115, 0.3);
      }

      .cancel-btn {
        background: linear-gradient(135deg, #ff4757 0%, #ff3742 100%);
        color: white;
        border: none;
        padding: 1rem 2rem;
        border-radius: 10px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        flex: 1;
        transition: all 0.3s;
      }

      .cancel-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(255, 71, 87, 0.3);
      }

      /* My Orders List Styles */
      .orders-container {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        padding: 2rem;
        backdrop-filter: blur(10px);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      }

      .order-card {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 1.5rem;
        margin-bottom: 1rem;
        border-left: 4px solid #667eea;
        transition: transform 0.3s, box-shadow 0.3s;
      }

      .order-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .order-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
      }

      .order-id {
        font-weight: bold;
        color: #333;
      }

      .order-status {
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        text-transform: uppercase;
      }

      .status-pending {
        background: #fff3cd;
        color: #856404;
      }

      .status-confirmed {
        background: #d4edda;
        color: #155724;
      }

      .status-cancelled {
        background: #f8d7da;
        color: #721c24;
      }

      .order-details {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .order-amount {
        font-size: 1.2rem;
        font-weight: bold;
        color: #2ed573;
      }

      .view-order-btn {
        background: #667eea;
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 5px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: background-color 0.3s;
      }

      .view-order-btn:hover {
        background: #5a6fd8;
      }

      /* Success Page */
      .success-container {
        text-align: center;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        padding: 3rem;
        backdrop-filter: blur(10px);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        max-width: 600px;
        margin: 0 auto;
      }

      .success-icon {
        font-size: 5rem;
        color: #2ed573;
        margin-bottom: 2rem;
      }

      .success-title {
        font-size: 2.5rem;
        color: #333;
        margin-bottom: 1rem;
      }

      .success-message {
        font-size: 1.2rem;
        color: #666;
        margin-bottom: 2rem;
      }

      .continue-shopping-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 1rem 2rem;
        border-radius: 10px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
      }

      .continue-shopping-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
      }

      /* Loading Spinner */
      .loading {
        display: none;
        text-align: center;
        padding: 2rem;
      }

      .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #667eea;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin: 0 auto 1rem;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Alert Messages */
      .alert {
        padding: 1rem;
        border-radius: 10px;
        margin-bottom: 1rem;
        font-weight: 500;
      }

      .alert-success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      .alert-error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      .alert-info {
        background: #cce7ff;
        color: #004085;
        border: 1px solid #b3d7ff;
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .nav {
          flex-direction: column;
          gap: 1rem;
        }

        .nav-links {
          gap: 1rem;
        }

        .products-grid {
          grid-template-columns: 1fr;
        }

        .auth-form {
          margin: 1rem;
          padding: 2rem;
        }

        .cart-item {
          flex-direction: column;
          text-align: center;
        }

        .form-row {
          flex-direction: column;
        }

        .products-header h1 {
          font-size: 2rem;
        }

        .order-actions {
          flex-direction: column;
        }

        .order-header {
          flex-direction: column;
          gap: 0.5rem;
          align-items: flex-start;
        }

        .order-details {
          flex-direction: column;
          gap: 1rem;
          align-items: flex-start;
        }
      }

      /* User Profile Dropdown */
      .user-menu {
        position: relative;
      }

      .user-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        cursor: pointer;
      }

      .user-dropdown {
        position: absolute;
        top: 100%;
        right: 0;
        background: white;
        border-radius: 10px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        padding: 1rem;
        min-width: 200px;
        display: none;
        z-index: 1000;
      }

      .user-dropdown.show {
        display: block;
      }

      .user-info {
        padding-bottom: 1rem;
        border-bottom: 1px solid #e1e8ed;
        margin-bottom: 1rem;
      }

      .user-name {
        font-weight: 600;
        color: #333;
      }

      .user-email {
        color: #666;
        font-size: 0.9rem;
      }

      .logout-btn {
        width: 100%;
        padding: 0.5rem;
        background: #ff4757;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-weight: 500;
      }

      .empty-cart {
        text-align: center;
        padding: 3rem;
        color: #666;
      }

      .empty-cart i {
        font-size: 4rem;
        margin-bottom: 1rem;
        color: #ccc;
      }

      /* Review Section Styles */
      .reviews-container {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        padding: 2rem;
        backdrop-filter: blur(10px);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      }

      .reviews-container h2 {
        text-align: center;
        margin-bottom: 2rem;
        color: #333;
        font-size: 2rem;
      }

      .review-card {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 1.5rem;
        margin-bottom: 1rem;
        border-left: 4px solid #667eea;
      }

      .review-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.5rem;
      }

      .reviewer-name {
        font-weight: 600;
        color: #333;
      }

      .review-date {
        font-size: 0.8rem;
        color: #999;
      }

      .review-rating .fas {
        color: #ffc107; /* Gold color for stars */
      }

      .review-comment {
        color: #555;
        margin-top: 1rem;
      }

      .review-form-section {
        margin-top: 2rem;
        padding-top: 2rem;
        border-top: 1px solid #e1e8ed;
      }

      .review-form-section h3 {
        margin-bottom: 1.5rem;
        color: #333;
      }

      .star-rating {
        display: flex;
        gap: 0.2rem;
        margin-bottom: 1rem;
      }

      .star-rating .fas {
        font-size: 1.5rem;
        color: #e1e8ed; /* Default grey for stars */
        cursor: pointer;
        transition: color 0.2s;
      }

      .star-rating .fas.selected {
        color: #ffc107; /* Gold for selected stars */
      }

      .my-reviews-container {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        padding: 2rem;
        backdrop-filter: blur(10px);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      }

      .my-reviews-container h2 {
        text-align: center;
        margin-bottom: 2rem;
        color: #333;
        font-size: 2rem;
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <nav class="nav">
        <a href="#" class="logo" onclick="showSection('products')">
          <i class="fas fa-tools"></i> ToolMart
        </a>
        <div class="nav-links">
          <div id="authLinks">
            <a href="#" class="nav-link" onclick="showSection('login')"
              >Login</a
            >
            <a href="#" class="nav-link" onclick="showSection('register')"
              >Register</a
            >
          </div>
          <div id="userMenu" class="user-menu" style="display: none">
            <div class="user-avatar" onclick="toggleUserDropdown()">
              <span id="userInitials">U</span>
            </div>
            <div class="user-dropdown" id="userDropdown">
              <div class="user-info">
                <div class="user-name" id="userName">User Name</div>
                <div class="user-email" id="userEmail">user@email.com</div>
              </div>
              <button class="logout-btn" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Logout
              </button>
            </div>
          </div>
          <div
            class="nav-icon"
            onclick="showMyOrders()"
            title="My Orders"
            id="myOrdersIcon"
            style="display: none"
          >
            <i class="fas fa-box"></i>
          </div>
          <div
            class="nav-icon"
            onclick="showMyReviews()"
            title="My Reviews"
            id="myReviewsIcon"
            style="display: none"
          >
            <i class="fas fa-star"></i>
          </div>
          <div class="cart-icon" onclick="showSection('cart')">
            <i class="fas fa-shopping-cart"></i>
            <span class="cart-count" id="cartCount">0</span>
          </div>
        </div>
      </nav>
    </header>

    <!-- Main Container -->
    <div class="container">
      <!-- Register Section -->
      <section id="register" class="page-section">
        <div class="auth-container">
          <form class="auth-form" id="registerForm">
            <h2><i class="fas fa-user-plus"></i> Create Account</h2>
            <div id="registerAlert"></div>

            <div class="form-group">
              <label for="regFirstName">First Name</label>
              <input type="text" id="regFirstName" name="first_name" required />
            </div>

            <div class="form-group">
              <label for="regLastName">Last Name</label>
              <input type="text" id="regLastName" name="last_name" required />
            </div>

            <div class="form-group">
              <label for="regUsername">Username</label>
              <input type="text" id="regUsername" name="userName" required />
            </div>

            <div class="form-group">
              <label for="regEmail">Email</label>
              <input type="email" id="regEmail" name="email" required />
            </div>

            <div class="form-group">
              <label for="regPassword">Password</label>
              <input
                type="password"
                id="regPassword"
                name="password"
                required
              />
            </div>

            <div class="form-group">
              <label for="regMobile">Mobile Number</label>
              <input
                type="tel"
                id="regMobile"
                name="mobile_no"
                placeholder="+1234567890"
              />
            </div>

            <button type="submit" class="btn" id="registerBtn">
              <i class="fas fa-user-plus"></i> Create Account
            </button>

            <div class="auth-switch">
              Already have an account?
              <a href="#" onclick="showSection('login')">Login here</a>
            </div>
          </form>
        </div>
      </section>

      <!-- Login Section -->
      <section id="login" class="page-section">
        <div class="auth-container">
          <form class="auth-form" id="loginForm">
            <h2><i class="fas fa-sign-in-alt"></i> Welcome Back</h2>
            <div id="loginAlert"></div>

            <div class="form-group">
              <label for="loginIdentifier">Email or Username</label>
              <input
                type="text"
                id="loginIdentifier"
                name="identifier"
                required
              />
            </div>

            <div class="form-group">
              <label for="loginPassword">Password</label>
              <input
                type="password"
                id="loginPassword"
                name="password"
                required
              />
            </div>

            <button type="submit" class="btn" id="loginBtn">
              <i class="fas fa-sign-in-alt"></i> Login
            </button>

            <div class="auth-switch">
              Don't have an account?
              <a href="#" onclick="showSection('register')">Register here</a>
            </div>
          </form>
        </div>
      </section>

      <!-- Products Section -->
      <section id="products" class="page-section active">
        <div class="products-header">
          <h1><i class="fas fa-tools"></i> Professional Tools</h1>
          <div class="search-bar">
            <i class="fas fa-search"></i>
            <input
              type="text"
              id="searchInput"
              placeholder="Search for tools..."
              onkeyup="searchProducts()"
            />
          </div>
        </div>

        <div class="loading" id="productsLoading">
          <div class="spinner"></div>
          <p>Loading products...</p>
        </div>

        <div class="products-grid" id="productsGrid">
          <!-- Products will be loaded here -->
        </div>
      </section>

      <!-- Cart Section -->
      <section id="cart" class="page-section">
        <div class="cart-container">
          <h2><i class="fas fa-shopping-cart"></i> Shopping Cart</h2>
          <div id="cartItems">
            <!-- Cart items will be loaded here -->
          </div>
          <div class="cart-total" id="cartTotal" style="display: none">
            <div class="total-amount">
              Total: $<span id="totalAmount">0.00</span>
            </div>
            <button class="checkout-btn" onclick="proceedToCheckout()">
              <i class="fas fa-credit-card"></i> Proceed to Checkout
            </button>
          </div>
        </div>
      </section>

      <!-- My Orders Section -->
      <section id="myOrders" class="page-section">
        <div class="orders-container">
          <h2><i class="fas fa-box"></i> My Orders</h2>
          <div class="loading" id="ordersLoading">
            <div class="spinner"></div>
            <p>Loading orders...</p>
          </div>
          <div id="ordersList">
            <!-- Orders will be loaded here -->
          </div>
        </div>
      </section>

      <!-- Reviews Section -->
      <section id="reviews" class="page-section">
        <div class="reviews-container">
          <h2 id="reviewsHeader">
            <i class="fas fa-star"></i> Reviews for Product
          </h2>
          <div class="loading" id="reviewsLoading">
            <div class="spinner"></div>
            <p>Loading reviews...</p>
          </div>
          <div id="reviewsList">
            <!-- Reviews will be loaded here -->
          </div>

          <div
            id="reviewFormSection"
            class="review-form-section"
            style="display: none"
          >
            <h3>Write a Review</h3>
            <div id="reviewAlert"></div>
            <form id="reviewForm">
              <div class="form-group">
                <label for="reviewRating">Rating</label>
                <div class="star-rating" id="starRating">
                  <i class="fas fa-star" data-rating="1"></i>
                  <i class="fas fa-star" data-rating="2"></i>
                  <i class="fas fa-star" data-rating="3"></i>
                  <i class="fas fa-star" data-rating="4"></i>
                  <i class="fas fa-star" data-rating="5"></i>
                </div>
                <input
                  type="hidden"
                  id="reviewRatingInput"
                  name="rating"
                  value="0"
                  required
                />
              </div>
              <div class="form-group">
                <label for="reviewComment">Comment</label>
                <textarea
                  id="reviewComment"
                  name="comment"
                  rows="5"
                  required
                ></textarea>
              </div>
              <button type="submit" class="btn" id="submitReviewBtn">
                <i class="fas fa-paper-plane"></i> Submit Review
              </button>
            </form>
          </div>
        </div>
      </section>

      <!-- My Reviews Section -->
      <section id="myReviews" class="page-section">
        <div class="my-reviews-container">
          <h2><i class="fas fa-star"></i> My Reviews</h2>
          <div class="loading" id="myReviewsLoading">
            <div class="spinner"></div>
            <p>Loading your reviews...</p>
          </div>
          <div id="myReviewsList">
            <!-- My reviews will be loaded here -->
          </div>
        </div>
      </section>

      <!-- Checkout Section -->
      <section id="checkout" class="page-section">
        <div class="checkout-container">
          <div class="checkout-header">
            <h2><i class="fas fa-credit-card"></i> Checkout</h2>
            <p>Complete your order details</p>
          </div>

          <div class="order-summary" id="checkoutSummary">
            <!-- Order summary will be loaded here -->
          </div>

          <form class="checkout-form" id="checkoutForm">
            <h3>Shipping Address</h3>
            <div class="form-group">
              <label for="street">Street Address</label>
              <input type="text" id="street" name="street" required />
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="city">City</label>
                <input type="text" id="city" name="city" required />
              </div>
              <div class="form-group">
                <label for="state">State</label>
                <input type="text" id="state" name="state" required />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="zipCode">ZIP Code</label>
                <input type="text" id="zipCode" name="zipCode" required />
              </div>
              <div class="form-group">
                <label for="country">Country</label>
                <input
                  type="text"
                  id="country"
                  name="country"
                  value="USA"
                  required
                />
              </div>
            </div>

            <button type="submit" class="save-btn" id="saveBtn">
              <i class="fas fa-save"></i> Save & Continue
            </button>
          </form>
        </div>
      </section>

      <!-- My Order Page Section -->
      <section id="myOrder" class="page-section">
        <div class="order-page-container">
          <div class="checkout-header">
            <h2><i class="fas fa-box"></i> My Order</h2>
            <p>Review and confirm your order</p>
          </div>

          <div class="order-summary" id="myOrderSummary">
            <!-- Order details will be loaded here -->
          </div>

          <div class="order-actions">
            <button class="confirm-btn" onclick="confirmOrder()">
              <i class="fas fa-check"></i> Confirm Order
            </button>
            <button class="cancel-btn" onclick="cancelOrder()">
              <i class="fas fa-times"></i> Cancel Order
            </button>
          </div>
        </div>
      </section>

      <!-- Success Section -->
      <section id="success" class="page-section">
        <div class="success-container">
          <div class="success-icon">
            <i class="fas fa-check-circle"></i>
          </div>
          <h2 class="success-title">Payment Successful!</h2>
          <p class="success-message">
            Thank you for your purchase. Your order has been confirmed and will
            be processed shortly.
          </p>
          <div id="orderDetails">
            <!-- Order details will be shown here -->
          </div>
          <button class="continue-shopping-btn" onclick="continueShopping()">
            <i class="fas fa-shopping-bag"></i> Continue Shopping
          </button>
        </div>
      </section>
    </div>

    <script>
      // Configuration
      const API_BASE_URL = "http://localhost:3001/";

      // Global state
      let currentUser = null;
      let authToken = null;
      let cart = [];
      let products = [];
      let currentOrder = null;
      let userOrders = [];
      let currentProductIdForReviews = null; // To store the product ID for the reviews section

      // Initialize app
      document.addEventListener("DOMContentLoaded", function () {
        checkAuthStatus();
        loadProducts();
        loadCart();
        setupFormHandlers();
        setupStarRating();
      });

      // Authentication functions
      function checkAuthStatus() {
        const token = localStorage.getItem("authToken");
        const user = localStorage.getItem("currentUser");

        if (token && user) {
          authToken = token;
          currentUser = JSON.parse(user);
          updateUIForLoggedInUser();
        }
      }

      function updateUIForLoggedInUser() {
        document.getElementById("authLinks").style.display = "none";
        document.getElementById("userMenu").style.display = "block";
        document.getElementById("myOrdersIcon").style.display = "block";
        document.getElementById("myReviewsIcon").style.display = "block"; // Show My Reviews icon

        const userInitials =
          (currentUser.first_name?.[0] || "") +
          (currentUser.last_name?.[0] || "");
        document.getElementById("userInitials").textContent =
          userInitials || "U";
        document.getElementById("userName").textContent = `${
          currentUser.first_name || ""
        } ${currentUser.last_name || ""}`.trim();
        document.getElementById("userEmail").textContent =
          currentUser.email || "";

        // Show review form if logged in
        document.getElementById("reviewFormSection").style.display = "block";
      }

      function updateUIForLoggedOutUser() {
        document.getElementById("authLinks").style.display = "flex";
        document.getElementById("userMenu").style.display = "none";
        document.getElementById("myOrdersIcon").style.display = "none";
        document.getElementById("myReviewsIcon").style.display = "none"; // Hide My Reviews icon

        // Hide review form if logged out
        document.getElementById("reviewFormSection").style.display = "none";
      }

      function toggleUserDropdown() {
        const dropdown = document.getElementById("userDropdown");
        dropdown.classList.toggle("show");
      }

      function logout() {
        localStorage.removeItem("authToken");
        localStorage.removeItem("currentUser");
        localStorage.removeItem("cart");

        authToken = null;
        currentUser = null;
        cart = [];
        userOrders = [];

        updateUIForLoggedOutUser();
        updateCartUI();
        showSection("products");
        showAlert("success", "Logged out successfully!");
      }

      // Form handlers
      function setupFormHandlers() {
        // Register form
        document
          .getElementById("registerForm")
          .addEventListener("submit", async function (e) {
            e.preventDefault();
            await handleRegister();
          });

        // Login form
        document
          .getElementById("loginForm")
          .addEventListener("submit", async function (e) {
            e.preventDefault();
            await handleLogin();
          });

        // Checkout form
        document
          .getElementById("checkoutForm")
          .addEventListener("submit", async function (e) {
            e.preventDefault();
            await handleCheckout();
          });

        // Review form
        document
          .getElementById("reviewForm")
          .addEventListener("submit", async function (e) {
            e.preventDefault();
            await handleSubmitReview();
          });
      }

      async function handleRegister() {
        const form = document.getElementById("registerForm");
        const formData = new FormData(form);
        const data = Object.fromEntries(formData);

        const registerBtn = document.getElementById("registerBtn");
        registerBtn.disabled = true;
        registerBtn.innerHTML =
          '<i class="fas fa-spinner fa-spin"></i> Creating Account...';

        try {
          const response = await fetch(`${API_BASE_URL}v3/auth/register`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(data),
          });

          const result = await response.json();

          if (response.ok) {
            showAlert(
              "success",
              "Account created successfully! Please login.",
              "registerAlert"
            );
            setTimeout(() => showSection("login"), 2000);
          } else {
            showAlert(
              "error",
              result.message || "Registration failed",
              "registerAlert"
            );
          }
        } catch (error) {
          showAlert(
            "error",
            "Network error. Please try again.",
            "registerAlert"
          );
        } finally {
          registerBtn.disabled = false;
          registerBtn.innerHTML =
            '<i class="fas fa-user-plus"></i> Create Account';
        }
      }

      async function handleLogin() {
        const form = document.getElementById("loginForm");
        const formData = new FormData(form);
        const data = Object.fromEntries(formData);

        const loginBtn = document.getElementById("loginBtn");
        loginBtn.disabled = true;
        loginBtn.innerHTML =
          '<i class="fas fa-spinner fa-spin"></i> Logging in...';

        try {
          const response = await fetch(`${API_BASE_URL}v1/auth/login`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(data),
          });

          const result = await response.json();

          if (response.ok) {
            authToken = result.access_token;
            localStorage.setItem("authToken", authToken);

            await getUserProfile();

            showAlert("success", "Login successful!", "loginAlert");
            setTimeout(() => {
              showSection("products");
              loadCart();
            }, 1000);
          } else {
            showAlert("error", result.message || "Login failed", "loginAlert");
          }
        } catch (error) {
          showAlert("error", "Network error. Please try again.", "loginAlert");
        } finally {
          loginBtn.disabled = false;
          loginBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Login';
        }
      }

      async function getUserProfile() {
        try {
          const response = await fetch(`${API_BASE_URL}v1/user/profile`, {
            headers: {
              Authorization: `Bearer ${authToken}`,
            },
          });

          if (response.ok) {
            const result = await response.json();
            currentUser = result.user;
            localStorage.setItem("currentUser", JSON.stringify(currentUser));
            updateUIForLoggedInUser();
          }
        } catch (error) {
          console.error("Error fetching user profile:", error);
        }
      }

      // Products functions
      async function loadProducts() {
        const loading = document.getElementById("productsLoading");
        const grid = document.getElementById("productsGrid");

        loading.style.display = "block";

        try {
          const response = await fetch(`${API_BASE_URL}v1/products/getAll`);
          const result = await response.json();

          if (response.ok) {
            products = Array.isArray(result) ? result : result.data || [];
            displayProducts(products);
          } else {
            showAlert("error", "Failed to load products");
          }
        } catch (error) {
          showAlert("error", "Network error while loading products");
          console.error("Error loading products:", error);
        } finally {
          loading.style.display = "none";
        }
      }

      function displayProducts(productsToShow) {
        const grid = document.getElementById("productsGrid");

        if (!productsToShow || productsToShow.length === 0) {
          grid.innerHTML =
            '<div class="empty-cart"><i class="fas fa-box-open"></i><h3>No products found</h3></div>';
          return;
        }

        grid.innerHTML = productsToShow
          .map(
            (product) => `
                <div class="product-card">
                    <div class="product-image">
                        <i class="fas fa-tools"></i>
                    </div>
                    <div class="product-info">
                        <div class="product-name">${
                          product.name || "Unknown Product"
                        }</div>
                        <div class="product-brand">${
                          product.brand?.name || "Unknown Brand"
                        }</div>
                        <div class="product-price">$${parseFloat(
                          product.price || 0
                        ).toFixed(2)}</div>
                        <div class="product-description">${
                          product.description || "No description available"
                        }</div>
                        <button class="add-to-cart-btn" onclick="addToCart('${
                          product.id
                        }')">
                            <i class="fas fa-cart-plus"></i> Add to Cart
                        </button>
                        <button class="view-reviews-btn" onclick="showSection('reviews', '${
                          product.id
                        }', '${product.name}')">
                            <i class="fas fa-star"></i> View Reviews
                        </button>
                    </div>
                </div>
            `
          )
          .join("");
      }

      function searchProducts() {
        const searchTerm = document
          .getElementById("searchInput")
          .value.toLowerCase();

        if (!searchTerm) {
          displayProducts(products);
          return;
        }

        const filteredProducts = products.filter(
          (product) =>
            (product.name || "").toLowerCase().includes(searchTerm) ||
            (product.description || "").toLowerCase().includes(searchTerm) ||
            (product.brand?.name || "").toLowerCase().includes(searchTerm)
        );

        displayProducts(filteredProducts);
      }

      // Cart functions
      async function addToCart(productId) {
        if (!authToken) {
          showAlert("info", "Please login to add items to cart");
          showSection("login");
          return;
        }

        try {
          const response = await fetch(
            `${API_BASE_URL}v1/cart/add/${productId}?quantity=1`,
            {
              method: "POST",
              headers: {
                Authorization: `Bearer ${authToken}`,
              },
            }
          );

          if (response.ok) {
            showAlert("success", "Item added to cart!");
            loadCart();
          } else {
            const result = await response.json();
            showAlert("error", result.message || "Failed to add item to cart");
          }
        } catch (error) {
          showAlert("error", "Network error while adding to cart");
        }
      }

      async function loadCart() {
        if (!authToken) {
          cart = [];
          updateCartUI();
          return;
        }

        try {
          const response = await fetch(`${API_BASE_URL}v1/cart`, {
            headers: {
              Authorization: `Bearer ${authToken}`,
            },
          });

          if (response.ok) {
            const result = await response.json();
            cart = result.items || [];
            updateCartUI();
          } else {
            cart = [];
            updateCartUI();
          }
        } catch (error) {
          console.error("Error loading cart:", error);
          cart = [];
          updateCartUI();
        }
      }

      function updateCartUI() {
        const cartCount = document.getElementById("cartCount");
        const cartItems = document.getElementById("cartItems");
        const cartTotal = document.getElementById("cartTotal");
        const totalAmount = document.getElementById("totalAmount");

        const itemCount = cart.reduce(
          (sum, item) => sum + (item.quantity || 0),
          0
        );
        cartCount.textContent = itemCount;

        if (cart.length === 0) {
          cartItems.innerHTML =
            '<div class="empty-cart"><i class="fas fa-shopping-cart"></i><h3>Your cart is empty</h3><p>Add some products to get started!</p></div>';
          cartTotal.style.display = "none";
          return;
        }

        const total = cart.reduce(
          (sum, item) =>
            sum + parseFloat(item.price || 0) * (item.quantity || 0),
          0
        );

        cartItems.innerHTML = cart
          .map(
            (item) => `
                <div class="cart-item">
                    <div class="cart-item-image">
                        <i class="fas fa-tools"></i>
                    </div>
                    <div class="cart-item-info">
                        <div class="cart-item-name">${
                          item.product?.name || "Unknown Product"
                        }</div>
                        <div class="cart-item-price">$${parseFloat(
                          item.price || 0
                        ).toFixed(2)}</div>
                        <div class="quantity-controls">
                            <button class="quantity-btn" onclick="updateCartItemQuantity('${
                              item.id
                            }', ${item.quantity - 1})">-</button>
                            <span class="quantity">${item.quantity}</span>
                            <button class="quantity-btn" onclick="updateCartItemQuantity('${
                              item.id
                            }', ${item.quantity + 1})">+</button>
                        </div>
                    </div>
                    <button class="remove-btn" onclick="removeFromCart('${
                      item.id
                    }')">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `
          )
          .join("");

        totalAmount.textContent = total.toFixed(2);
        cartTotal.style.display = "block";
      }

      async function updateCartItemQuantity(itemId, newQuantity) {
        if (newQuantity <= 0) {
          removeFromCart(itemId);
          return;
        }

        try {
          const response = await fetch(
            `${API_BASE_URL}v1/cart/update/${itemId}?quantity=${newQuantity}`,
            {
              method: "PATCH",
              headers: {
                Authorization: `Bearer ${authToken}`,
              },
            }
          );

          if (response.ok) {
            loadCart();
          } else {
            showAlert("error", "Failed to update cart item");
          }
        } catch (error) {
          showAlert("error", "Network error while updating cart");
        }
      }

      async function removeFromCart(itemId) {
        try {
          const response = await fetch(
            `${API_BASE_URL}v1/cart/remove/${itemId}`,
            {
              method: "DELETE",
              headers: {
                Authorization: `Bearer ${authToken}`,
              },
            }
          );

          if (response.ok) {
            loadCart();
            showAlert("success", "Item removed from cart");
          } else {
            showAlert("error", "Failed to remove item from cart");
          }
        } catch (error) {
          showAlert("error", "Network error while removing item");
        }
      }

      // My Orders functions
      async function showMyOrders() {
        if (!authToken) {
          showAlert("info", "Please login to view orders");
          showSection("login");
          return;
        }

        showSection("myOrders");
        await loadMyOrders();
      }

      async function loadMyOrders() {
        const loading = document.getElementById("ordersLoading");
        const ordersList = document.getElementById("ordersList");

        loading.style.display = "block";

        try {
          const response = await fetch(
            `${API_BASE_URL}v1/orders/my-orders?page=1&limit=10`,
            {
              headers: {
                Authorization: `Bearer ${authToken}`,
              },
            }
          );

          if (response.ok) {
            const result = await response.json();
            userOrders = Array.isArray(result.orders) ? result.orders : [];
            displayOrders(userOrders);
          } else {
            showAlert("error", "Failed to load orders");
            ordersList.innerHTML =
              '<div class="empty-cart"><i class="fas fa-box-open"></i><h3>Failed to load orders</h3></div>';
          }
        } catch (error) {
          showAlert("error", "Network error while loading orders");
          console.error("Error loading orders:", error);
          ordersList.innerHTML =
            '<div class="empty-cart"><i class="fas fa-box-open"></i><h3>Network error</h3></div>';
        } finally {
          loading.style.display = "none";
        }
      }

      function displayOrders(orders) {
        const ordersList = document.getElementById("ordersList");

        if (!orders || orders.length === 0) {
          ordersList.innerHTML =
            '<div class="empty-cart"><i class="fas fa-box-open"></i><h3>No orders found</h3><p>You haven\'t placed any orders yet.</p></div>';
          return;
        }

        ordersList.innerHTML = orders
          .map(
            (order) => `
                <div class="order-card">
                    <div class="order-header">
                        <div class="order-id">Order #${
                          order.orderNumber || order.id
                        }</div>
                        <div class="order-status status-${(
                          order.status || "pending"
                        ).toLowerCase()}">${order.status || "Pending"}</div>
                    </div>
                    <div class="order-details">
                        <div>
                            <div style="color: #666; font-size: 0.9rem;">
                                ${new Date(
                                  order.createdAt || Date.now()
                                ).toLocaleDateString()}
                            </div>
                            <div class="order-amount">$${parseFloat(
                              order.totalAmount || 0
                            ).toFixed(2)}</div>
                        </div>
                        <button class="view-order-btn" onclick="viewOrderDetails('${
                          order.id
                        }')">
                            View Details
                        </button>
                    </div>
                </div>
            `
          )
          .join("");
      }

      async function viewOrderDetails(orderId) {
        try {
          await loadMyOrderPage(orderId);
        } catch (error) {
          showAlert("error", "Failed to load order details");
        }
      }

      // NEW FLOW: Cart → Checkout → Create Order → My Order Page
      async function proceedToCheckout() {
        if (!authToken) {
          showAlert("info", "Please login to proceed");
          showSection("login");
          return;
        }

        if (cart.length === 0) {
          showAlert("error", "Your cart is empty");
          return;
        }

        // Show checkout page with order summary
        const checkoutSummary = document.getElementById("checkoutSummary");
        const subtotal = cart.reduce(
          (sum, item) =>
            sum + parseFloat(item.price || 0) * (item.quantity || 0),
          0
        );
        const tax = subtotal * 0.08; // 8% tax
        const shipping = subtotal > 100 ? 0 : 15;
        const total = subtotal + tax + shipping;

        checkoutSummary.innerHTML = `
                <h3>Order Summary</h3>
                ${cart
                  .map(
                    (item) => `
                    <div class="summary-item">
                        <span>${item.product?.name || "Unknown Product"} (${
                      item.quantity
                    }x)</span>
                        <span>$${(
                          parseFloat(item.price || 0) * (item.quantity || 0)
                        ).toFixed(2)}</span>
                    </div>
                `
                  )
                  .join("")}
                <div class="summary-item">
                    <span>Subtotal</span>
                    <span>$${subtotal.toFixed(2)}</span>
                </div>
                <div class="summary-item">
                    <span>Tax (8%)</span>
                    <span>$${tax.toFixed(2)}</span>
                </div>
                <div class="summary-item">
                    <span>Shipping</span>
                    <span>$${shipping.toFixed(2)}</span>
                </div>
                <div class="summary-total">
                    <span>Total</span>
                    <span>$${total.toFixed(2)}</span>
                </div>
            `;

        showSection("checkout");
      }

      // Handle checkout form submission - Create Order API call
      async function handleCheckout() {
        const form = document.getElementById("checkoutForm");
        const formData = new FormData(form);
        const shippingAddress = Object.fromEntries(formData);

        const saveBtn = document.getElementById("saveBtn");
        saveBtn.disabled = true;
        saveBtn.innerHTML =
          '<i class="fas fa-spinner fa-spin"></i> Creating Order...';

        try {
          // Step 1: Create Order API call
          const orderResponse = await fetch(`${API_BASE_URL}v1/orders/create`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${authToken}`,
            },
            body: JSON.stringify({
              shippingAddress,
              billingAddress: shippingAddress,
            }),
          });

          const order = await orderResponse.json();
          if (!orderResponse.ok) {
            throw new Error(order.message || "Failed to create order");
          }

          currentOrder = order;
          showAlert("success", "Order created successfully!");

          // Step 2: Redirect to My Order page
          await loadMyOrderPage(order.id);
        } catch (error) {
          showAlert("error", error.message || "Failed to create order");
        } finally {
          saveBtn.disabled = false;
          saveBtn.innerHTML = '<i class="fas fa-save"></i> Save & Continue';
        }
      }

      // Load My Order page with order details
      async function loadMyOrderPage(orderId) {
        try {
          // Call order/:id API to get order details
          const response = await fetch(`${API_BASE_URL}v1/orders/${orderId}`, {
            headers: {
              Authorization: `Bearer ${authToken}`,
            },
          });

          const order = await response.json();
          if (!response.ok) {
            throw new Error(order.message || "Order not found");
          }

          currentOrder = order;
          const myOrderSummary = document.getElementById("myOrderSummary");

          // Display order details
          myOrderSummary.innerHTML = `
                <h3>Order Details</h3>
                <div class="summary-item">
                    <span><strong>Order ID:</strong></span>
                    <span>${order.id}</span>
                </div>
                <div class="summary-item">
                    <span><strong>Order Number:</strong></span>
                    <span>${order.orderNumber || "N/A"}</span>
                </div>
                <div class="summary-item">
                    <span><strong>Status:</strong></span>
                    <span>${order.status || "Pending"}</span>
                </div>
                <hr style="margin: 1rem 0;">
                ${
                  order.items
                    ? order.items
                        .map(
                          (item) => `
                        <div class="summary-item">
                            <span>${item.product?.name || "Unknown"} (${
                            item.quantity
                          }x)</span>
                            <span>$${(
                              parseFloat(item.price || 0) * item.quantity
                            ).toFixed(2)}</span>
                        </div>
                    `
                        )
                        .join("")
                    : cart
                        .map(
                          (item) => `
                        <div class="summary-item">
                            <span>${item.product?.name || "Unknown"} (${
                            item.quantity
                          }x)</span>
                            <span>$${(
                              parseFloat(item.price || 0) * item.quantity
                            ).toFixed(2)}</span>
                        </div>
                    `
                        )
                        .join("")
                }
                <div class="summary-total">
                    <span>Total Amount</span>
                    <span>$${parseFloat(order.totalAmount || 0).toFixed(
                      2
                    )}</span>
                </div>
                <hr style="margin: 1rem 0;">
                <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px;">
                    <h4>Shipping Address:</h4>
                    <p>${order.shippingAddress?.street || "N/A"}</p>
                    <p>${order.shippingAddress?.city || ""}, ${
            order.shippingAddress?.state || ""
          } ${order.shippingAddress?.zipCode || ""}</p>
                    <p>${order.shippingAddress?.country || ""}</p>
                </div>
            `;

          showSection("myOrder");
        } catch (error) {
          showAlert("error", error.message || "Could not load order details");
          showSection("products");
        }
      }

      // Confirm Order - Simply show success page
      async function confirmOrder() {
        if (!currentOrder) {
          showAlert("error", "No order found");
          return;
        }

        // Clear cart after order confirmation
        cart = [];
        updateCartUI();

        // Show success page directly
        showOrderSuccess(currentOrder);
      }

      // Cancel Order - Call delete order/:id API
      async function cancelOrder() {
        if (!currentOrder) {
          showAlert("error", "No order found");
          return;
        }

        if (confirm("Are you sure you want to cancel this order?")) {
          try {
            // Call delete order/:id API
            const response = await fetch(
              `${API_BASE_URL}v1/orders/${currentOrder.id}`,
              {
                method: "DELETE",
                headers: {
                  Authorization: `Bearer ${authToken}`,
                },
              }
            );

            if (response.ok) {
              showAlert("success", "Order cancelled successfully");
              currentOrder = null;
              showSection("products");
            } else {
              const result = await response.json();
              showAlert("error", result.message || "Failed to cancel order");
            }
          } catch (error) {
            showAlert("error", "Network error while cancelling order");
            console.error("Cancel order error:", error);
          }
        }
      }

      // Show order success page
      function showOrderSuccess(order) {
        const orderDetails = document.getElementById("orderDetails");
        orderDetails.innerHTML = `
    <div style="background: #f8f9fa; padding: 1rem; border-radius: 10px; margin: 1rem 0;">
      <h4>Order Details</h4>
      <p><strong>Order ID:</strong> ${order.id}</p>
      <p><strong>Order Number:</strong> ${order.orderNumber || "N/A"}</p>
      <p><strong>Total Amount:</strong> $${parseFloat(
        order.totalAmount || 0
      ).toFixed(2)}</p>
      <p><strong>Status:</strong> Confirmed</p>
      <p style="font-weight: bold; color: #ff4757; margin-top: 1.5rem;">
        ⚠️ Payment integration is currently under development by the developer.
      </p>
    </div>
  `;

        showSection("success");
      }

      function continueShopping() {
        showSection("products");
        loadProducts();
      }

      // Review functions
      async function loadProductReviews(productId, productName) {
        currentProductIdForReviews = productId; // Store product ID for review submission
        const reviewsHeader = document.getElementById("reviewsHeader");
        reviewsHeader.innerHTML = `<i class="fas fa-star"></i> Reviews for ${
          productName || "Product"
        }`;

        const loading = document.getElementById("reviewsLoading");
        const reviewsList = document.getElementById("reviewsList");
        const reviewFormSection = document.getElementById("reviewFormSection");

        loading.style.display = "block";
        reviewsList.innerHTML = ""; // Clear previous reviews

        // Show/hide review form based on auth status
        reviewFormSection.style.display = authToken ? "block" : "none";

        try {
          const response = await fetch(
            `${API_BASE_URL}v1/reviews/product/${productId}?page=1&limit=10`
          );
          const result = await response.json();

          if (response.ok) {
            const reviews = Array.isArray(result.reviews)
              ? result.reviews
              : [];
            displayReviews(reviews, reviewsList);
          } else {
            showAlert("error", "Failed to load product reviews");
            reviewsList.innerHTML =
              '<div class="empty-cart"><i class="fas fa-star-half-alt"></i><h3>Failed to load reviews</h3></div>';
          }
        } catch (error) {
          showAlert("error", "Network error while loading product reviews");
          console.error("Error loading product reviews:", error);
          reviewsList.innerHTML =
            '<div class="empty-cart"><i class="fas fa-star-half-alt"></i><h3>Network error</h3></div>';
        } finally {
          loading.style.display = "none";
        }
      }

      function displayReviews(reviews, container) {
        if (!reviews || reviews.length === 0) {
          container.innerHTML =
            '<div class="empty-cart"><i class="fas fa-star-half-alt"></i><h3>No reviews yet</h3><p>Be the first to review this product!</p></div>';
          return;
        }

        container.innerHTML = reviews
          .map(
            (review) => `
                <div class="review-card">
                    <div class="review-header">
                        <div class="reviewer-name">${
                          review.user?.first_name || "Anonymous"
                        }</div>
                        <div class="review-date">${new Date(
                          review.createdAt
                        ).toLocaleDateString()}</div>
                    </div>
                    <div class="review-rating">
                        ${generateStarRatingHtml(review.rating)}
                    </div>
                    <div class="review-comment">
                        <p>${review.comment || "No comment provided."}</p>
                    </div>
                </div>
            `
          )
          .join("");
      }

      function generateStarRatingHtml(rating) {
        let stars = "";
        for (let i = 1; i <= 5; i++) {
          stars += `<i class="fas fa-star ${
            i <= rating ? "selected" : ""
          }"></i>`;
        }
        return stars;
      }

      function setupStarRating() {
        const stars = document.querySelectorAll("#starRating .fas");
        const ratingInput = document.getElementById("reviewRatingInput");

        stars.forEach((star) => {
          star.addEventListener("click", () => {
            const rating = parseInt(star.dataset.rating);
            ratingInput.value = rating;
            stars.forEach((s, index) => {
              if (index < rating) {
                s.classList.add("selected");
              } else {
                s.classList.remove("selected");
              }
            });
          });
        });
      }

      async function handleSubmitReview() {
        if (!authToken) {
          showAlert("error", "You must be logged in to submit a review.", "reviewAlert");
          return;
        }
        if (!currentProductIdForReviews) {
          showAlert("error", "No product selected for review.", "reviewAlert");
          return;
        }

        const rating = document.getElementById("reviewRatingInput").value;
        const comment = document.getElementById("reviewComment").value;

        if (rating === "0" || !comment.trim()) {
          showAlert("error", "Please provide a rating and a comment.", "reviewAlert");
          return;
        }

        const submitBtn = document.getElementById("submitReviewBtn");
        submitBtn.disabled = true;
        submitBtn.innerHTML =
          '<i class="fas fa-spinner fa-spin"></i> Submitting...';

        try {
          const response = await fetch(`${API_BASE_URL}v1/reviews`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${authToken}`,
            },
            body: JSON.stringify({
              productId: currentProductIdForReviews,
              rating: parseInt(rating),
              comment: comment.trim(),
            }),
          });

          const result = await response.json();

          if (response.ok) {
            showAlert("success", "Review submitted successfully!", "reviewAlert");
            // Clear form
            document.getElementById("reviewRatingInput").value = "0";
            document.getElementById("reviewComment").value = "";
            document.querySelectorAll("#starRating .fas").forEach(s => s.classList.remove("selected"));
            // Reload reviews for the current product
            const currentProduct = products.find(p => p.id === currentProductIdForReviews);
            await loadProductReviews(currentProductIdForReviews, currentProduct?.name);
          } else {
            showAlert("error", result.message || "Failed to submit review", "reviewAlert");
          }
        } catch (error) {
          showAlert("error", "Network error. Please try again.", "reviewAlert");
          console.error("Error submitting review:", error);
        } finally {
          submitBtn.disabled = false;
          submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Submit Review';
        }
      }

      async function showMyReviews() {
        if (!authToken) {
          showAlert("info", "Please login to view your reviews");
          showSection("login");
          return;
        }

        showSection("myReviews");
        await loadMyReviews();
      }

      async function loadMyReviews() {
        const loading = document.getElementById("myReviewsLoading");
        const myReviewsList = document.getElementById("myReviewsList");

        loading.style.display = "block";
        myReviewsList.innerHTML = ""; // Clear previous reviews

        try {
          const response = await fetch(`${API_BASE_URL}v1/reviews/my-reviews`, {
            headers: {
              Authorization: `Bearer ${authToken}`,
            },
          });
          const result = await response.json();

          if (response.ok) {
            const reviews = Array.isArray(result.reviews)
              ? result.reviews
              : [];
            displayMyReviews(reviews, myReviewsList);
          } else {
            showAlert("error", "Failed to load your reviews");
            myReviewsList.innerHTML =
              '<div class="empty-cart"><i class="fas fa-star-half-alt"></i><h3>Failed to load your reviews</h3></div>';
          }
        } catch (error) {
          showAlert("error", "Network error while loading your reviews");
          console.error("Error loading my reviews:", error);
          myReviewsList.innerHTML =
            '<div class="empty-cart"><i class="fas fa-star-half-alt"></i><h3>Network error</h3></div>';
        } finally {
          loading.style.display = "none";
        }
      }

      function displayMyReviews(reviews, container) {
        if (!reviews || reviews.length === 0) {
          container.innerHTML =
            '<div class="empty-cart"><i class="fas fa-star-half-alt"></i><h3>You haven\'t written any reviews yet.</h3><p>Review a product to see it here!</p></div>';
          return;
        }

        container.innerHTML = reviews
          .map(
            (review) => `
                <div class="review-card">
                    <div class="review-header">
                        <div class="reviewer-name">Review for: ${
                          review.product?.name || "Unknown Product"
                        }</div>
                        <div class="review-date">${new Date(
                          review.createdAt
                        ).toLocaleDateString()}</div>
                    </div>
                    <div class="review-rating">
                        ${generateStarRatingHtml(review.rating)}
                    </div>
                    <div class="review-comment">
                        <p>${review.comment || "No comment provided."}</p>
                    </div>
                </div>
            `
          )
          .join("");
      }

      // Utility functions
      function showSection(sectionId, productId = null, productName = null) {
        // Hide all sections
        const sections = document.querySelectorAll(".page-section");
        sections.forEach((section) => section.classList.remove("active"));

        // Show target section
        const targetSection = document.getElementById(sectionId);
        if (targetSection) {
          targetSection.classList.add("active");
        }

        // Special handling for reviews section
        if (sectionId === "reviews" && productId) {
          loadProductReviews(productId, productName);
        }

        // Close user dropdown if open
        const dropdown = document.getElementById("userDropdown");
        dropdown.classList.remove("show");
      }

      function showAlert(type, message, containerId = null) {
        const alertClass = `alert alert-${type}`;
        const alertHtml = `<div class="${alertClass}">${message}</div>`;

        if (containerId) {
          const container = document.getElementById(containerId);
          if (container) {
            container.innerHTML = alertHtml;
            setTimeout(() => {
              container.innerHTML = "";
            }, 5000);
          }
        } else {
          // Show global alert
          const existingAlert = document.querySelector(".global-alert");
          if (existingAlert) {
            existingAlert.remove();
          }

          const alertDiv = document.createElement("div");
          alertDiv.className = `global-alert ${alertClass}`;
          alertDiv.style.cssText = `
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        z-index: 10000;
                        max-width: 400px;
                        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
                    `;
          alertDiv.innerHTML = message;

          document.body.appendChild(alertDiv);

          setTimeout(() => {
            alertDiv.remove();
          }, 5000);
        }
      }

      // Close dropdowns when clicking outside
      document.addEventListener("click", function (event) {
        const userMenu = document.getElementById("userMenu");
        const dropdown = document.getElementById("userDropdown");

        if (!userMenu.contains(event.target)) {
          dropdown.classList.remove("show");
        }
      });
    </script>
  </body>
</html>

<!-- The key changes I made:

1. **Added "My Orders" icon** next to the cart icon in the navbar with a box icon (`fas fa-box`)
2. **Added visibility control** - the My Orders icon only shows when user is logged in
3. **Created new "My Orders" section** with order cards displaying order details
4. **Added `showMyOrders()` function** to handle clicking the My Orders icon
5. **Added `loadMyOrders()` function** to fetch user orders from the API (`/v1/orders/user`)
6. **Added `displayOrders()` function** to render the orders list with proper styling
7. **Added `viewOrderDetails()` function** to view individual order details
8. **Added order status styling** with different colors for pending, confirmed, and cancelled orders
9. **Added responsive design** for mobile devices

The My Orders button will:
- Only appear when the user is logged in
- Call the `/v1/orders/user` API to fetch all user orders
- Display orders in cards with order number, status, date, amount, and a "View Details" button
- Allow users to click "View Details" to see the full order information
- Show appropriate empty state when no orders exist -->
